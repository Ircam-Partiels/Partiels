set(VAMP_SDK_DIRECTORY "${CMAKE_CURRENT_LIST_DIR}/vamp-plugin-sdk")
set(VAMP_HOST_SDK_DIRECTORY "${VAMP_SDK_DIRECTORY}/vamp-hostsdk")
set(VAMP_HOST_SOURCES_DIRECTORY "${VAMP_SDK_DIRECTORY}/src/vamp-hostsdk")
set(VAMP_PLUGIN_SOURCES_DIRECTORY "${VAMP_SDK_DIRECTORY}/src/vamp-sdk")

file(GLOB VAMP_HOST_SDK_HEADERS ${VAMP_HOST_SDK_DIRECTORY}/*h)
file(GLOB VAMP_HOST_SDK_SOURCES ${VAMP_HOST_SOURCES_DIRECTORY}/*h  ${VAMP_HOST_SOURCES_DIRECTORY}/*cpp ${VAMP_HOST_SOURCES_DIRECTORY}/*c)
source_group("Vamp" FILES ${VAMP_HOST_SDK_HEADERS} ${VAMP_HOST_SDK_SOURCES})
add_library(vamp STATIC ${VAMP_HOST_SDK_HEADERS} ${VAMP_HOST_SDK_SOURCES})
target_compile_definitions(vamp PUBLIC _VAMP_NO_HOST_NAMESPACE=1)
if(WIN32)
  target_compile_definitions(vamp PRIVATE _USE_MATH_DEFINES)
  target_compile_options(vamp PRIVATE /wd4996 /wd4267)
elseif(APPLE)
  set_target_properties(vamp PROPERTIES ARCHIVE_OUTPUT_DIRECTORY "./")
  target_compile_options(vamp PRIVATE -Wno-conversion)
endif()
target_include_directories(vamp PUBLIC ${VAMP_SDK_DIRECTORY})

file(GLOB VAMP_PLUGIN_SOURCES ${VAMP_PLUGIN_SOURCES_DIRECTORY}/PluginAdapter.cpp ${VAMP_PLUGIN_SOURCES_DIRECTORY}/RealTime.cpp  ${VAMP_PLUGIN_SOURCES_DIRECTORY}/FFT.cpp)
source_group("Vamp/Plugin" FILES ${VAMP_PLUGIN_SOURCES})
add_library(vamp-plugin STATIC ${VAMP_PLUGIN_SOURCES})
if(WIN32)
  target_compile_definitions(vamp-plugin PRIVATE _USE_MATH_DEFINES)
  target_compile_options(vamp-plugin PRIVATE /wd4996 /wd4267)
  set_target_properties(vamp-plugin PROPERTIES MSVC_RUNTIME_LIBRARY "MultiThreaded")
elseif(APPLE)
  set_target_properties(vamp-plugin PROPERTIES ARCHIVE_OUTPUT_DIRECTORY "./")
  target_compile_options(vamp-plugin PRIVATE -Wno-conversion)
else()
  set_property(TARGET vamp-plugin PROPERTY POSITION_INDEPENDENT_CODE ON)
endif()
target_include_directories(vamp-plugin PUBLIC ${VAMP_SDK_DIRECTORY})
